<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact Scraper - Growth Swift</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        textarea { resize: none; }
    </style>
  </head>
  <body class="bg-gradient-to-br from-gray-50 to-gray-200 min-h-screen flex flex-col items-center p-8">

    <header class="bg-white shadow-md rounded-2xl px-6 py-4 flex justify-between items-center w-full max-w-4xl mb-10 border border-gray-100">
      <div class="w-40 flex items-center justify-center">
        <img src="/static/logo.png" alt="Logo" class="max-h-12 object-contain" />
      </div>
      <div class="text-right">
        <h1 class="text-xl font-bold text-gray-800 tracking-tight">Contact Scraper</h1>
        <span class="text-xs text-gray-500 uppercase tracking-wider">Lead Generation Tool</span>
      </div>
    </header>

    <main class="bg-white/90 backdrop-blur-xl p-8 rounded-2xl shadow-xl border border-gray-100 w-full max-w-2xl space-y-6">
      
      <a href="/" class="inline-flex items-center text-gray-500 hover:text-purple-600 transition mb-2">
        ‚Üê Back to Hub
      </a>

      <div class="space-y-4">
        <input id="urlInput" type="url" placeholder="https://company.com/team"
             class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none" required />

        <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-600">Pages to crawl:</span>
            <input id="maxPages" type="number" value="1" min="1" max="5" class="w-20 p-2 border border-gray-300 rounded-lg text-center" />
        </div>

        <button id="scrapeBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-xl font-medium shadow-lg transition">
          Find Emails & Contacts
        </button>
      </div>

      <div id="loading" class="hidden text-center py-6">
        <div class="animate-pulse flex flex-col items-center">
            <div class="h-4 w-4 bg-blue-600 rounded-full mb-2"></div>
            <p class="text-sm text-gray-500">Scanning pages for patterns...</p>
        </div>
      </div>

      <div id="resultsArea" class="hidden">
        <div class="flex justify-between items-end mb-2">
            <h3 class="font-bold text-gray-700">Found Contacts:</h3>
            <button id="dlBtn" class="text-sm text-blue-600 hover:underline">Download CSV</button>
        </div>
        <textarea id="output" rows="10" class="w-full p-4 border border-gray-200 rounded-xl bg-gray-50 font-mono text-xs text-gray-600" readonly></textarea>
      </div>

    </main>

    <script>
      let currentResults = [];

      document.getElementById("scrapeBtn").addEventListener("click", async () => {
        const url = document.getElementById("urlInput").value;
        const max_pages = document.getElementById("maxPages").value;

        if (!url) return alert("Please enter a URL");

        document.getElementById("loading").classList.remove("hidden");
        document.getElementById("resultsArea").classList.add("hidden");

        try {
            const res = await fetch("/api/crawl", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ url, max_pages })
            });

            const data = await res.json();
            
            if (data.success) {
                currentResults = data.results;
                let text = "";
                data.results.forEach(item => {
                    text += `[${item.first_name}]\nEmail: ${item.email}\nSource: ${item.source_page}\n------------------\n`;
                });
                document.getElementById("output").value = text || "No contacts found.";
                document.getElementById("resultsArea").classList.remove("hidden");
            } else {
                alert("Error: " + data.error);
            }
        } catch (e) {
            alert("Connection failed.");
        } finally {
            document.getElementById("loading").classList.add("hidden");
        }
      });

      document.getElementById("dlBtn").addEventListener("click", () => {
         fetch("/api/download", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ results: currentResults })
         })
         .then(res => res.blob())
         .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "contacts.csv";
            a.click();
         });
      });
    </script>
  </body>
</html>